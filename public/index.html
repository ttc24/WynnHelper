<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wynncraft Helper</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <style>
    :root{
      --color-bg-0:#070b15;
      --color-bg-1:#0e1527;
      --color-bg-2:#131d33;
      --color-surface-1:rgba(14,20,36,.86);
      --color-surface-2:rgba(12,17,30,.96);
      --color-surface-3:rgba(23,31,53,.90);
      --color-surface-soft:rgba(255,255,255,.05);
      --color-border-strong:rgba(164,182,255,.3);
      --color-border:rgba(164,182,255,.2);
      --color-border-soft:rgba(255,255,255,.12);
      --color-text:#e8edff;
      --color-text-soft:rgba(233,239,255,.74);
      --color-text-muted:rgba(204,214,255,.58);
      --color-accent:#8f98ff;
      --color-accent-strong:#7782ff;
      --color-accent-soft:rgba(143,152,255,.2);
      --color-focus:rgba(143,152,255,.45);
      --color-success:rgba(118,214,178,.85);

      --font-sans:Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --font-mono:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --text-xs:.78rem;
      --text-sm:.9rem;
      --text-base:1rem;
      --text-lg:1.08rem;
      --text-xl:1.35rem;
      --weight-normal:400;
      --weight-medium:500;
      --weight-semibold:600;
      --weight-bold:700;
      --leading-tight:1.2;
      --leading-base:1.45;

      --space-1:.25rem;
      --space-2:.5rem;
      --space-3:.75rem;
      --space-4:1rem;
      --space-5:1.25rem;
      --space-6:1.5rem;
      --space-7:2rem;

      --radius-sm:8px;
      --radius-md:12px;
      --radius-lg:16px;
      --radius-pill:999px;

      --shadow-sm:0 8px 20px rgba(0,0,0,.22);
      --shadow-md:0 16px 32px rgba(0,0,0,.28);
      --shadow-lg:0 20px 48px rgba(0,0,0,.36);

      --duration-fast:120ms;
      --duration-base:180ms;
      --easing-standard:cubic-bezier(.2,.8,.2,1);

      --pico-primary: var(--color-accent);
      --pico-primary-hover: var(--color-accent-strong);
      --pico-primary-focus: var(--color-focus);
      --pico-card-border-color: var(--color-border-soft);
    }
    body{
      font-family: var(--font-sans);
      color: var(--color-text);
      background: radial-gradient(1200px 600px at 20% -10%, rgba(95,118,255,.34), transparent 60%),
                  radial-gradient(900px 500px at 90% 0%, rgba(74,166,226,.20), transparent 55%),
                  linear-gradient(180deg, var(--color-bg-1), var(--color-bg-0));
      line-height: var(--leading-base);
    }
    main.container{ padding-block: var(--space-4) var(--space-7); }
    header.siteHeader { padding: var(--space-2) 0 var(--space-4); }
    .siteTitle { margin: 0 0 var(--space-1); font-size: var(--text-xl); font-weight: var(--weight-bold); line-height: var(--leading-tight); }
    .leadText { margin: 0; max-width: 70ch; }

    .grid2 { display: grid; grid-template-columns: 460px 1fr; gap: var(--space-4); align-items: start; }
    .stack { display:grid; gap:var(--space-4); align-content:start; }

    .sectionCard,
    .card {
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      background: linear-gradient(180deg, rgba(31,42,70,.45), rgba(16,23,40,.88));
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(10px);
    }
    .sectionCardHeader { display:flex; justify-content:space-between; align-items:center; gap: var(--space-3); margin-bottom: var(--space-2); }

    .small { font-size: var(--text-sm); color: var(--color-text-soft); }
    .mono { font-family: var(--font-mono); }
    .row { display:flex; gap:var(--space-3); flex-wrap: wrap; align-items: end; margin-top: var(--space-2); }
    .row:first-child { margin-top: 0; }
    .controlLabel { min-width: 180px; margin-bottom: 0; font-size: var(--text-sm); color: var(--color-text-soft); display: grid; gap: var(--space-1); }
    .controlLabel.isWide { min-width: 220px; }
    .controlLabel.isNarrow { min-width: 120px; }
    .controlLabel.isCompact { min-width: 150px; }
    .isHidden { display:none; }
    .scrollBox { min-height: 70px; max-height: 240px; overflow:auto; }

    .slotRow { display:grid; grid-template-columns: 95px minmax(0,1fr) auto; gap:var(--space-2); align-items:center; margin-bottom:var(--space-3); }
    .slotRow input { margin:0; }
    .slotHead { display:flex; justify-content: space-between; align-items:center; gap: var(--space-3); margin-bottom:var(--space-2); }
    .pillRow { display:flex; flex-wrap:wrap; gap:var(--space-2); }
    .pill { display:inline-flex; align-items:center; gap:var(--space-2); padding:var(--space-1) var(--space-3); border:1px solid var(--color-border); border-radius:var(--radius-pill); background: rgba(255,255,255,.07); transition: background var(--duration-base) var(--easing-standard), border-color var(--duration-base) var(--easing-standard); }
    .pill:hover { background: rgba(255,255,255,.12); border-color: var(--color-border-strong); }

    .suggest { position:relative; }
    .suggestList{
      position:absolute; z-index:50; left:0; right:0; top:calc(100% + 4px);
      border:1px solid var(--color-border-soft);
      background: var(--color-surface-2);
      border-radius:var(--radius-md);
      overflow:hidden;
      max-height:280px;
      overflow-y:auto;
      box-shadow:var(--shadow-lg);
    }
    .suggestItem { padding:var(--space-2) var(--space-3); cursor:pointer; display:flex; justify-content:space-between; gap:var(--space-3); transition: background var(--duration-fast) var(--easing-standard); }
    .suggestItem > span,
    .slotRow .small,
    .badge { word-break: normal; overflow-wrap: normal; }
    .suggestItem > span:first-child { white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
    .suggestItem:hover, .suggestItem.active { background: var(--color-accent-soft); }
    .suggestMeta { color: var(--color-text-muted); }

    .badge { font-size:var(--text-xs); padding:var(--space-1) var(--space-2); border-radius:var(--radius-pill); border:1px solid var(--color-border); background: rgba(255,255,255,.08); color: var(--color-text-soft); }
    .resultsGrid {
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: var(--space-4);
      max-height: 72vh;
      overflow-y: auto;
      padding-right: var(--space-1);
      align-content: start;
      margin-top: var(--space-3);
    }
    .resultSlotCard { display:grid; gap: var(--space-2); border:1px solid var(--color-border); border-radius: var(--radius-md); background: var(--color-surface-1); padding: var(--space-3); box-shadow: var(--shadow-sm); }
    .resultSlotList { display:grid; gap: var(--space-2); }
    .resultSlotTitle { margin:0; font-size: var(--text-lg); font-weight: var(--weight-semibold); color: var(--color-text); }
    .resultItem { border:1px solid var(--color-border-soft); border-radius: var(--radius-sm); padding:var(--space-3); background: var(--color-surface-soft); margin-top: var(--space-2); }
    .resultTop { display:flex; justify-content:space-between; gap:var(--space-3); align-items:flex-start; }
    .resultNameLine { display:flex; gap:var(--space-2); flex-wrap:wrap; align-items:center; }
    .resultActions { display:flex; gap:var(--space-2); flex-wrap:wrap; }

    button, .btnTiny {
      border-radius: var(--radius-sm);
      transition: transform var(--duration-fast) var(--easing-standard), background var(--duration-base) var(--easing-standard), border-color var(--duration-base) var(--easing-standard), box-shadow var(--duration-base) var(--easing-standard);
    }
    .btnTiny { padding:.42rem .65rem; font-size:var(--text-sm); font-weight: var(--weight-medium); white-space: nowrap; min-width: 72px; }
    button:hover:not(:disabled), .pill:has(input:focus-visible) { transform: translateY(-1px); }
    button:active:not(:disabled) { transform: translateY(0); }
    .btnTiny:disabled, .resultTop .btnTiny:disabled {
      opacity: .5;
      cursor: not-allowed;
      filter: grayscale(.25);
      transform: none;
    }

    input, select, textarea {
      background: var(--color-surface-3) !important;
      color: #eef2ff !important;
      border:1px solid var(--color-border) !important;
      border-radius: var(--radius-sm) !important;
      margin-bottom: 0;
      transition: border-color var(--duration-base) var(--easing-standard), box-shadow var(--duration-base) var(--easing-standard);
    }
    input:focus, select:focus, textarea:focus, button:focus-visible, summary:focus-visible, .suggestItem:focus-visible {
      outline: none;
      border-color: var(--color-accent) !important;
      box-shadow: 0 0 0 3px var(--color-focus);
    }

    .mutedBox,
    .auxSurface { border:1px dashed var(--color-border); border-radius:var(--radius-md); padding:var(--space-3); background: var(--color-surface-soft); }
    .debugBox { margin-top: var(--space-2); }
    .workflowStep { margin-bottom: var(--space-5); }
    .workflowStep:last-child { margin-bottom: 0; }
    .stepTitle { display:flex; gap:var(--space-2); align-items:center; margin:0 0 var(--space-2) 0; }
    .stepHeading { margin:0; font-size: var(--text-lg); font-weight: var(--weight-semibold); }
    .stepBadge { font-size:var(--text-xs); padding:var(--space-1) var(--space-2); border-radius:var(--radius-pill); border:1px solid var(--color-border); color:var(--color-text-soft); }
    .metaGrid { display:grid; gap:var(--space-2); margin-top:var(--space-2); }
    .quickLine { margin:0; }
    .intentGroup { margin-top:var(--space-3); }
    .intentGroup .small { margin:0 0 var(--space-2) 0; }
    .slotMeta { margin-bottom: var(--space-2); display:flex; gap:var(--space-2); flex-wrap: wrap; }
    .detailsPanel { margin-top: var(--space-3); }
    .spacedTop { margin-top: var(--space-3); }
    .spacedTiny { margin-top: var(--space-2); }
    .preWrap { white-space: pre-wrap; }
    .dialogRowBetween { justify-content: space-between; align-items: center; }
    .dialogRowEnd { justify-content: flex-end; }

    dialog { border:1px solid var(--color-border); border-radius: var(--radius-lg); padding: 0; width: min(760px, 95vw); background: var(--color-surface-2); color: var(--color-text); box-shadow: var(--shadow-lg); }
    dialog .dwrap { padding: var(--space-5); }
    dialog::backdrop { background: rgba(4,7,14,.68); }
    summary { color: #eff3ff; font-weight: var(--weight-medium); }

    @media (max-width: 1100px) {
      .grid2 { grid-template-columns: 1fr; }
      .resultsGrid { grid-template-columns: 1fr; }
      .slotRow { grid-template-columns: 88px minmax(0,1fr) auto; gap:.4rem; }
      .btnTiny { min-width: 68px; }
    }
  </style>
</head>
<body>
  <main class="container">
    <header class="siteHeader">
      <h2 class="siteTitle">Wynncraft Helper</h2>
      <p class="small leadText">
        Pick items on the left. Get compatible suggestions on the right. Swap mode helps fix broken builds fast.
      </p>
    </header>

    <div class="grid2">
      <section class="sectionCard">
        <div class="workflowStep">
          <div class="stepTitle">
            <span class="stepBadge">Step 1</span>
            <h4 class="stepHeading">Player + mode</h4>
          </div>

          <div class="row">
          <label class="controlLabel isNarrow">
            Level
            <input id="level" type="number" min="1" max="106" value="106" />
          </label>

          <label class="controlLabel">
            Class
            <select id="class">
              <option value="">(any)</option>
              <option value="warrior">Warrior</option>
              <option value="archer">Archer</option>
              <option value="mage">Mage</option>
              <option value="assassin">Assassin</option>
              <option value="shaman">Shaman</option>
            </select>
          </label>

          <label class="controlLabel isWide">
            Extra SP (quests/tomes/etc.)
            <input id="extraPoints" type="number" min="0" max="999" value="0" />
          </label>

          <label class="controlLabel isWide">
            Weapon class lock
            <select id="strictWeaponClass">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </label>
          </div>

          <div class="row">
            <label><input type="radio" name="mode" value="fill" id="modeFill" checked /> Fill missing slots</label>
            <label><input type="radio" name="mode" value="swap" id="modeSwap" /> Swap one slot</label>
          </div>
          <div id="swapBox" class="row isHidden">
            <label class="controlLabel isWide">
              Active slot
              <select id="swapKey">
                <option value="helmet">Helmet</option>
                <option value="chestplate">Chestplate</option>
                <option value="leggings">Leggings</option>
                <option value="boots">Boots</option>
                <option value="necklace">Necklace</option>
                <option value="bracelet">Bracelet</option>
                <option value="ring1">Ring 1</option>
                <option value="ring2">Ring 2</option>
                <option value="weapon">Weapon</option>
              </select>
            </label>
          </div>
          <p class="small spacedTiny">Fill mode scans all missing slots. Swap mode focuses only the active slot.</p>
        </div>

        <hr/>

        <div class="workflowStep">
          <div class="slotHead">
            <div class="stepTitle">
              <span class="stepBadge">Step 2</span>
              <h4 class="stepHeading">Gear selection</h4>
            </div>
            <button id="clearAll" class="secondary btnTiny">Clear all</button>
          </div>

          <p class="small">Click a slot to search and lock only the pieces you want to preserve.</p>
          <div id="slots"></div>
        </div>

        <details class="detailsPanel">
          <summary>Advanced filters</summary>

          <div class="intentGroup">
            <p class="small">Search behavior</p>
            <div class="row">
            <label class="controlLabel">
              Match
              <select id="searchMode">
                <option value="contains">Contains</option>
                <option value="starts">Starts with</option>
                <option value="fuzzy">Fuzzy</option>
              </select>
            </label>

            <label class="controlLabel">
              Sort by
              <select id="sortBy">
                <option value="bestRemaining">Best remaining SP</option>
                <option value="lowestFinalSpend">Lowest final spend</option>
                <option value="lowestLevel">Lowest level requirement</option>
                <option value="leastNegative">Least negative tradeoffs</option>
                <option value="highestSTR">Highest STR bonus</option>
                <option value="highestDEX">Highest DEX bonus</option>
                <option value="highestINT">Highest INT bonus</option>
                <option value="highestDEF">Highest DEF bonus</option>
                <option value="highestAGI">Highest AGI bonus</option>
              </select>
            </label>
            </div>
          </div>

          <div class="intentGroup">
            <p class="small">Quality constraints</p>
            <div class="row">
            <label class="controlLabel">
              Min level
              <input id="minItemLevel" type="number" min="0" max="106" value="0" />
            </label>

            <label class="controlLabel">
              Results / slot
              <input id="limit" type="number" min="10" max="500" value="150" />
            </label>
          </div>

          <div class="row">
            <label><input id="noMythic" type="checkbox"/> No mythic</label>
            <label><input id="noCrafted" type="checkbox"/> Exclude crafted/unidentified</label>
            <label><input id="noNegItem" type="checkbox"/> Block negative item stats</label>
            <label><input id="noNegNet" type="checkbox"/> Block negative net stats</label>
          </div>

          <div class="small spacedTiny">Allowed rarities</div>
          <div id="rarityBox" class="pillRow spacedTiny"></div>
          </div>

          <div class="intentGroup">
            <p class="small">Stat goals</p>
            <div class="row">
            <label class="controlLabel isWide">
              Require bonus to
              <select id="mustGiveStat">
                <option value="">(none)</option>
                <option value="strength">STR</option>
                <option value="dexterity">DEX</option>
                <option value="intelligence">INT</option>
                <option value="defence">DEF</option>
                <option value="agility">AGI</option>
              </select>
            </label>

            <label class="controlLabel isWide">
              Min Î” remaining SP
              <input id="minImprove" type="number" value="0" />
            </label>
          </div>
            </div>
          </div>
        </details>
      </section>

      <div class="stack">
        <section class="sectionCard">
          <div class="stepTitle">
            <span class="stepBadge">Step 3</span>
            <h4 class="stepHeading">Suggestions + results</h4>
          </div>

          <div class="metaGrid">
            <div id="status" class="small mutedBox"></div>
            <p id="statusQuick" class="small quickLine"></p>
          </div>

          <div id="results" class="resultsGrid"></div>

          <details class="detailsPanel">
            <summary>Build details</summary>
            <div id="alloc" class="small mono preWrap spacedTiny"></div>
            <div id="setSynergy" class="small mono preWrap spacedTiny"></div>
            <div id="notes" class="small spacedTiny"></div>
          </details>
        </section>

        <section class="sectionCard">
          <h4 class="stepHeading">Utility panel</h4>

          <details>
            <summary>Tomes</summary>
            <div class="suggest spacedTiny">
              <input id="tomeInput" placeholder="Search tomes..." autocomplete="off" />
              <div id="tomeList" class="suggestList isHidden"></div>
            </div>
            <div class="row">
              <button id="clearTomes" class="secondary btnTiny">Clear tomes</button>
            </div>
            <div id="tomePills" class="pillRow"></div>
          </details>

          <details class="detailsPanel">
            <summary>Explain / solve tools</summary>
            <div class="row spacedTiny">
              <label class="controlLabel isWide">
                Explain item
                <input id="explainName" placeholder="Exact item name" />
              </label>
              <button id="explainBtn" class="secondary btnTiny">Explain</button>
              <button id="solve" class="btnTiny">Solve full build</button>
            </div>
            <pre id="explainOut" class="small mono mutedBox spacedTiny scrollBox"></pre>
          </details>

          <details class="detailsPanel">
            <summary>Debug + maintenance</summary>
            <div class="row spacedTiny">
              <label><input id="debug" type="checkbox"/> Collect exclusion reasons</label>
              <label class="controlLabel isCompact">
                Sample cap
                <input id="debugLimit" type="number" min="0" max="200" value="80" />
              </label>
              <button id="reloadDb" class="secondary btnTiny">Force DB reload</button>
              <button id="refresh" class="btnTiny">Refresh</button>
            </div>
            <div id="debugBox" class="small mutedBox debugBox"></div>
          </details>
        </section>
      </div>
    </div>

    <dialog id="compareDlg">
      <div class="dwrap">
        <div class="row dialogRowBetween">
          <strong id="cmpTitle"></strong>
          <button id="cmpClose" class="secondary btnTiny">Close</button>
        </div>
        <div id="cmpBody" class="small mono preWrap spacedTiny"></div>
        <div class="row dialogRowEnd">
          <button id="cmpSwap" class="btnTiny">Swap</button>
        </div>
      </div>
    </dialog>

  </main>

  <script src="app.js"></script>
</body>
</html>
